// 랜덤 돌 생성 함수 (미니멀 + 불규칙 윤곽)
const 石 = () => ({
  x: random(width) - width / 2,
  y: random(40, 120),   // 바닥 근처
  z: random(1, 5),      // 깊이
  r: random(14, 40),    // 돌 크기
  seed: random(1000),   // noise 시드
  steps: int(random(14, 28)), // 윤곽 정점 개수
  wobble: random(0.2, 0.8),   // 얼마나 일그러질지
});

const 石道 = {
  stones: [],

  初期化() {
    for (let i = 0; i < 38; i++) {
      this.stones.push(石());
    }
  },

  更新() {
    for (const s of this.stones) {
      // 카메라 패닝 효과 (너가 원한 흐름)
      s.x -= (mouseX - width / 2) * 0.03;

      // 화면 좌·우 루프
      if (s.x > width / 2) s.x = -width / 2;
      if (s.x < -width / 2) s.x = width / 2;

      // 깊이 변환
      const my = constrain(mouseY, 0, height);
      s.z -= log(1 + my) / 200;

      if (s.z < 1) s.z = 5;
    }

    // 가까움 → 멀어짐 정렬
    this.stones.sort((a, b) => (a.z > b.z ? -1 : 1));
  },

  描く() {
    stroke(0);
    noFill();

    for (const s of this.stones) {
      push();

      // 원근 변환
      const px = s.x / s.z;
      const py = (200 + s.y) / s.z;
      const rr = s.r / s.z;

      translate(px, py);

      // ★ 미니멀한 불규칙 "선" 돌 윤곽 ★
      beginShape();
      for (let i = 0; i < s.steps; i++) {
        const a = map(i, 0, s.steps, 0, TWO_PI);

        let n = noise(
          s.seed + cos(a) * s.wobble,
          s.seed + sin(a) * s.wobble,
          frameCount * 0.002
        );

        const rad = rr * (0.6 + n * 0.9); // 일그러짐
        const vx = cos(a) * rad;
        const vy = sin(a) * rad * 0.7; // 세로 조금 눌림

        vertex(vx, vy);
      }
      endShape(CLOSE);

      pop();
    }
  },
};

function setup() {
  createCanvas(900, 600);
  石道.初期化();
}

function draw() {
  background(255);

  // 화면 중앙 아래로 이동
  translate(width / 2, height / 2 + 80);

  石道.更新();
  石道.描く();
}

